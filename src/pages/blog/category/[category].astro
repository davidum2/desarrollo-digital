---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import { getAllCategories } from "../../../utils/getAllCategories";
import CardBlog from "../../../components/CardBlog.astro";
import CardBlogRich from "../../../components/CardBlogRich.astro";
import ArticleList from "../../../layouts/ArticleList.astro";

export const getStaticPaths = (async () => {
  const categories = (await getAllCategories()).map((category) =>
    category.toLowerCase()
  );
  return categories.map((category) => ({
    params: { category },
    props: { category },
  }));
}) satisfies GetStaticPaths;

const { category } = Astro.props;

const posts = await getCollection("blog", ({ data }) =>
  data.categories.map((data) => data.toLowerCase()).includes(category)
);
const postsRich = await getCollection("blogPostRich", ({ data }) =>
  data.categories.map((data) => data.toLowerCase()).includes(category)
);
---

<ArticleList>
  <h1 class="font-libre text-3xl text-center">Nuestros Post m√°s recientes</h1>
  <div
    class="grid place-items-center md:grid-cols-2 lg:grid-cols-3 gap-6 m-auto mb-6"
  >
    {postsRich.map((post) => <CardBlogRich {...post.data} slug={post.slug} />)}
  </div>
  <h2 class="font-libre text-2xl text-center my-6">
    Otros temas dentro de la categoria
  </h2>
  <div
    class="grid place-items-center md:grid-cols-2 lg:grid-cols-3 gap-6 m-auto mb-6"
  >
    {posts.map((post) => <CardBlog {...post.data} slug={post.slug} />)}
  </div>
</ArticleList>
